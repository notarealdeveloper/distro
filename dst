#!/bin/bash

pkgs=(
    https://github.com/notarealdeveloper/callable_module
    https://github.com/notarealdeveloper/signalhandlers
    https://github.com/notarealdeveloper/interprocess
    https://github.com/notarealdeveloper/is_instance
    https://github.com/notarealdeveloper/executive
    https://github.com/notarealdeveloper/assure
    https://github.com/notarealdeveloper/babel
    https://github.com/notarealdeveloper/webfs
    https://github.com/notarealdeveloper/kern
    https://github.com/notarealdeveloper/mmry
    https://github.com/notarealdeveloper/embd
    https://github.com/notarealdeveloper/wnix
)

bootstrap() {
    mkdir -pv src
    pushd src >/dev/null
    for pkg in "${pkgs[@]}"; do
        dst="$(basename "$pkg")"
        if [[ ! -d "$dst" ]]; then
            git clone "$pkg"
        fi
    done
    popd >/dev/null
}

if [[ -z $1 || ! -d src ]]; then
    bootstrap
    exit 0
fi

pushd src >/dev/null
for pkg in *; do
    pushd "$pkg" >/dev/null
    echo "================="
    echo "# $pkg"
    $@
    popd >/dev/null
done
popd >/dev/null
echo "================="
